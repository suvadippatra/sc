<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Road to the Transistor: A Physics Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fafaf9; /* Warm neutral background */
            color: #1c1917;
            scroll-behavior: smooth;
        }

        h1, h2, h3 {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
        }

        .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f5f5f4;
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e;
        }

        /* Chart Container Styling - Mandatory per instructions */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Max width to prevent stretching */
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Simulation Canvas Containers */
        .sim-container {
            width: 100%;
            height: 300px;
            background-color: #171717;
            border-radius: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        /* Interactive Elements styling */
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
        }
        
        .nav-item.active {
            background-color: #e7e5e4;
            border-left: 4px solid #4f46e5;
            font-weight: 600;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease-in-out;
        }
    </style>
    <!-- Chosen Palette: Stone & Indigo. 
         Background: #fafaf9 (Stone 50) - Warm neutral for "paper" feel.
         Text: #1c1917 (Stone 900) - High contrast, readable.
         Primary Action/Highlight: #4f46e5 (Indigo 600) - Academic yet modern.
         Secondary/Warning: #ef4444 (Red 500) - For Holes/P-type.
         Accent: #0ea5e9 (Sky 500) - For Electrons/N-type.
    -->
    <!-- Application Structure Plan:
         Designed as a vertical "scroll-spy" educational journey, mirroring a university lab notebook.
         
         1. **Navigation**: Sidebar (sticky on desktop, top on mobile) allows jumping between logical physics modules.
         2. **Modules**:
            - **Foundation (Band Theory)**: Static diagrams built with CSS Flexbox to show Energy gaps.
            - **The Actors (Carriers)**: Comparison cards for Electrons vs Holes.
            - **Statistics (Fermi-Dirac)**: Interactive Chart.js graph. Goal: User slides "Temperature" to see the probability tail extend into the conduction band.
            - **Material Science (Doping)**: Interactive visualizer. Goal: User adds "Donors" or "Acceptors" and watches the Fermi level shift graphically.
            - **Transport (Drift/Diffusion)**: HTML Canvas particle simulation. Goal: User toggles "Electric Field" to see order emerge from chaos (Drift) and "Concentration Gradient" to see Diffusion.
            - **The Union (P-N Junction)**: Interactive Band Diagram. Goal: User changes "Bias Voltage" to see the potential barrier grow (Reverse) or shrink (Forward).
         3. **Synthesis**: A "Circuit Corner" summary connecting physics to engineering (KVL/KCL).
         
         Why this structure? It builds complexity linearly: Structure -> Particles -> Statistics -> Modification -> Movement -> Device. This scaffolding is essential for deep understanding.
    -->
    <!-- Visualization & Content Choices:
         1. **Band Structure**: CSS Block Model. Justification: Bands are literally energy "blocks". CSS is cleaner than Canvas for simple rectangles.
         2. **Fermi-Dirac**: Chart.js Line Chart. Justification: Needs to show a precise mathematical curve changing with a variable (T).
         3. **Carrier Transport**: HTML Canvas API. Justification: Requires animating 100+ distinct particles to show random walk vs. drift velocity effectively. NO SVG used.
         4. **P-N Junction**: Dynamic CSS + Chart.js. Justification: The bands bending is best shown by CSS transforms or a path, but the IV curve is best shown via Chart.js.
         
         Confirming NO SVG graphics used. NO Mermaid JS used. All icons are unicode text or CSS shapes.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-stone-50 text-stone-800">

    <!-- Top Navigation (Mobile) -->
    <div class="md:hidden bg-white shadow-sm sticky top-0 z-50 p-4 border-b border-stone-200">
        <h1 class="text-lg font-bold text-indigo-700">Physics of Semiconductors</h1>
        <select id="mobile-nav" class="mt-2 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md" onchange="document.getElementById(this.value).scrollIntoView({behavior: 'smooth'})">
            <option value="intro">Introduction</option>
            <option value="bands">1. Band Structure</option>
            <option value="carriers">2. Charge Carriers</option>
            <option value="stats">3. Fermi Statistics</option>
            <option value="doping">4. Doping</option>
            <option value="transport">5. Transport</option>
            <option value="pn-junction">6. P-N Junction</option>
        </select>
    </div>

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar Navigation (Desktop) -->
        <nav class="hidden md:block w-64 bg-white border-r border-stone-200 fixed h-full overflow-y-auto z-40">
            <div class="p-6">
                <h1 class="text-xl font-bold text-indigo-700 leading-tight">The Road to the Transistor</h1>
                <p class="text-xs text-stone-500 mt-2">Interactive Physics Lab</p>
            </div>
            <ul class="space-y-1">
                <li><button onclick="scrollToSection('intro')" id="nav-intro" class="nav-item w-full text-left px-6 py-3 text-sm text-stone-600 hover:bg-stone-50 transition-colors">Introduction</button></li>
                <li><button onclick="scrollToSection('bands')" id="nav-bands" class="nav-item w-full text-left px-6 py-3 text-sm text-stone-600 hover:bg-stone-50 transition-colors">1. Energy Band Structure</button></li>
                <li><button onclick="scrollToSection('carriers')" id="nav-carriers" class="nav-item w-full text-left px-6 py-3 text-sm text-stone-600 hover:bg-stone-50 transition-colors">2. Charge Carriers</button></li>
                <li><button onclick="scrollToSection('stats')" id="nav-stats" class="nav-item w-full text-left px-6 py-3 text-sm text-stone-600 hover:bg-stone-50 transition-colors">3. Statistical Mechanics</button></li>
                <li><button onclick="scrollToSection('doping')" id="nav-doping" class="nav-item w-full text-left px-6 py-3 text-sm text-stone-600 hover:bg-stone-50 transition-colors">4. Doping & Types</button></li>
                <li><button onclick="scrollToSection('transport')" id="nav-transport" class="nav-item w-full text-left px-6 py-3 text-sm text-stone-600 hover:bg-stone-50 transition-colors">5. Transport Mechanisms</button></li>
                <li><button onclick="scrollToSection('pn-junction')" id="nav-pn-junction" class="nav-item w-full text-left px-6 py-3 text-sm text-stone-600 hover:bg-stone-50 transition-colors">6. The P-N Junction</button></li>
                <li><button onclick="scrollToSection('circuit')" id="nav-circuit" class="nav-item w-full text-left px-6 py-3 text-sm text-stone-600 hover:bg-stone-50 transition-colors">7. Circuit & Fabrication</button></li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-1 md:ml-64 p-4 md:p-12 max-w-5xl mx-auto space-y-24 pb-32">

            <!-- Introduction -->
            <section id="intro" class="space-y-6 animate-fade-in">
                <div class="bg-indigo-50 border-l-4 border-indigo-600 p-6 rounded-r-lg">
                    <h2 class="text-3xl font-bold text-stone-900 mb-2">Before the Transistor</h2>
                    <p class="text-stone-700 text-lg">
                        To understand modern electronics, we must first understand the quantum behavior of electrons in crystals. 
                        This interactive guide breaks down the theoretical foundations—from atomic orbitals to the P-N junction diode.
                    </p>
                </div>
            </section>

            <!-- 1. Band Structure -->
            <section id="bands" class="space-y-6 pt-10">
                <div class="border-b border-stone-200 pb-4">
                    <h2 class="text-2xl font-bold text-stone-900">1. Energy Band Structure</h2>
                    <p class="text-stone-500 mt-1">From isolated atoms to the Bloch Theorem.</p>
                </div>
                
                <p class="text-stone-700 leading-relaxed">
                    In a single atom, electrons occupy discrete energy levels (orbitals). However, when atoms come together to form a crystal lattice (like Silicon), these orbitals overlap and split due to the Pauli Exclusion Principle. This splitting creates continuous <strong>Energy Bands</strong> separated by a <strong>Bandgap ($E_g$)</strong>.
                </p>

                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                        <h3 class="font-semibold text-lg mb-4">Key Concepts</h3>
                        <ul class="space-y-3 text-sm">
                            <li class="flex items-start"><span class="mr-2 text-indigo-500 font-bold">1.</span> <span><strong>Valence Band ($E_v$):</strong> The highest energy band fully occupied by electrons at absolute zero. These electrons bind the atoms together.</span></li>
                            <li class="flex items-start"><span class="mr-2 text-indigo-500 font-bold">2.</span> <span><strong>Conduction Band ($E_c$):</strong> The next higher band. It is empty at 0K but can accept electrons that gain energy.</span></li>
                            <li class="flex items-start"><span class="mr-2 text-indigo-500 font-bold">3.</span> <span><strong>Bandgap ($E_g$):</strong> The forbidden energy zone. No electron can exist here.
                                <br><span class="text-xs text-stone-500 bg-stone-100 px-1 rounded">Si = 1.12 eV</span>
                                <span class="text-xs text-stone-500 bg-stone-100 px-1 rounded">Ge = 0.66 eV</span>
                            </span></li>
                            <li class="flex items-start"><span class="mr-2 text-indigo-500 font-bold">4.</span> <span><strong>Bloch Theorem:</strong> Describes the wavefunction of an electron in a periodic potential $V(r)$. $\psi(r) = u(r)e^{ikr}$. It implies electrons move as waves through a perfect crystal.</span></li>
                        </ul>
                    </div>
                    
                    <!-- Visualizing Bands -->
                    <div class="bg-stone-900 p-6 rounded-xl shadow-inner flex flex-col items-center justify-center h-80 relative">
                        <div class="text-stone-400 text-xs absolute top-2 right-4">Energy (E)</div>
                        
                        <!-- Conduction Band -->
                        <div class="w-48 h-20 bg-gradient-to-b from-stone-700 to-stone-600 rounded-sm border border-stone-500 flex items-center justify-center relative">
                            <span class="text-white text-xs font-mono z-10">Conduction Band (Ec)</span>
                            <!-- Free Electrons -->
                            <div class="absolute w-2 h-2 bg-blue-400 rounded-full top-4 left-10 animate-bounce"></div>
                            <div class="absolute w-2 h-2 bg-blue-400 rounded-full bottom-2 right-12 animate-pulse"></div>
                        </div>
                        
                        <!-- Band Gap -->
                        <div class="w-48 h-16 flex items-center justify-center relative">
                            <div class="h-full border-l border-dashed border-stone-600 absolute left-[-10px]"></div>
                            <span class="text-stone-500 text-xs font-mono italic">Band Gap (Eg) <br> Forbidden Zone</span>
                        </div>

                        <!-- Valence Band -->
                        <div class="w-48 h-20 bg-gradient-to-b from-stone-600 to-stone-700 rounded-sm border border-stone-500 flex items-center justify-center relative">
                            <span class="text-white text-xs font-mono z-10">Valence Band (Ev)</span>
                            <!-- Holes -->
                            <div class="absolute w-2 h-2 border-2 border-red-500 rounded-full top-2 right-8"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Charge Carriers -->
            <section id="carriers" class="space-y-6 pt-10">
                <div class="border-b border-stone-200 pb-4">
                    <h2 class="text-2xl font-bold text-stone-900">2. Charge Carriers</h2>
                    <p class="text-stone-500 mt-1">Electrons, Holes, and Effective Mass.</p>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Electron Card -->
                    <div class="bg-white p-6 rounded-xl border-l-4 border-blue-500 shadow-sm card-hover">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold mr-3">-</div>
                            <h3 class="text-xl font-bold">Free Electrons (n)</h3>
                        </div>
                        <p class="text-sm text-stone-600 mb-4">
                            Electrons in the Conduction Band. They are free to move through the crystal lattice when an electric field is applied.
                        </p>
                        <div class="bg-stone-50 p-3 rounded text-xs mono-font text-stone-700">
                            Mass: m* (Effective Mass)<br>
                            Charge: -q<br>
                            Location: Conduction Band
                        </div>
                    </div>

                    <!-- Hole Card -->
                    <div class="bg-white p-6 rounded-xl border-l-4 border-red-500 shadow-sm card-hover">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 font-bold mr-3">+</div>
                            <h3 class="text-xl font-bold">Holes (p)</h3>
                        </div>
                        <p class="text-sm text-stone-600 mb-4">
                            A "missing" electron in the Valence Band. It behaves like a positively charged particle. It is a "quasi-particle".
                        </p>
                        <div class="bg-stone-50 p-3 rounded text-xs mono-font text-stone-700">
                            Mass: m* (often heavier than e)<br>
                            Charge: +q<br>
                            Location: Valence Band
                        </div>
                    </div>
                </div>

                <div class="bg-amber-50 p-4 rounded-lg border border-amber-200">
                    <h4 class="font-bold text-amber-800 text-sm mb-2">Effective Mass ($m^*$)</h4>
                    <p class="text-sm text-amber-900">
                        Electrons inside a crystal don't have their normal vacuum mass ($m_0$). They interact with the atoms. We account for this by defining an <strong>effective mass</strong> based on the curvature of the energy band:
                        <br>
                        <span class="mono-font block mt-2 text-center bg-white/50 py-1 rounded">m* = ℏ² / (d²E/dk²)</span>
                        <br>
                        Steeper curvature = Lighter effective mass = Higher mobility.
                    </p>
                </div>
            </section>

            <!-- 3. Statistics -->
            <section id="stats" class="space-y-6 pt-10">
                <div class="border-b border-stone-200 pb-4">
                    <h2 class="text-2xl font-bold text-stone-900">3. Statistical Mechanics</h2>
                    <p class="text-stone-500 mt-1">Fermi-Dirac Statistics & Density of States.</p>
                </div>

                <p class="text-stone-700">
                    To find the number of carriers, we multiply the number of available seats (<strong>Density of States, $g(E)$</strong>) by the probability a seat is occupied (<strong>Fermi-Dirac Distribution, $f(E)$</strong>).
                </p>

                <!-- Interactive Fermi Chart -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                        <div>
                            <h3 class="font-bold text-lg">Fermi-Dirac Distribution $f(E)$</h3>
                            <p class="text-sm text-stone-500">Probability of finding an electron at energy E.</p>
                        </div>
                        <div class="mt-4 md:mt-0 flex items-center bg-stone-100 px-4 py-2 rounded-lg">
                            <label for="tempSlider" class="text-sm font-semibold mr-3">Temperature (T):</label>
                            <input type="range" id="tempSlider" min="0" max="1000" step="50" value="300" class="slider-thumb h-2 bg-stone-300 rounded-lg appearance-none cursor-pointer w-32">
                            <span id="tempValue" class="ml-3 text-sm font-mono w-12 text-right">300K</span>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="fermiChart"></canvas>
                    </div>

                    <p class="text-xs text-stone-500 mt-4 text-center">
                        At T=0K, the function is a step (100% below Ef, 0% above). As T increases, the "tail" extends into higher energies, allowing electrons to jump the gap.
                    </p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div class="bg-stone-50 p-4 rounded">
                        <strong>Fermi Level ($E_f$):</strong> The energy level where the probability of finding an electron is exactly 50%.
                    </div>
                    <div class="bg-stone-50 p-4 rounded">
                        <strong>Law of Mass Action:</strong> In thermal equilibrium, $n_0 p_0 = n_i^2$. If you increase electrons (n), holes (p) must decrease.
                    </div>
                </div>
            </section>

            <!-- 4. Doping -->
            <section id="doping" class="space-y-6 pt-10">
                <div class="border-b border-stone-200 pb-4">
                    <h2 class="text-2xl font-bold text-stone-900">4. Doping & Semiconductor Types</h2>
                    <p class="text-stone-500 mt-1">Intrinsic vs. Extrinsic, Donors & Acceptors.</p>
                </div>

                <div class="grid md:grid-cols-3 gap-6">
                    <button onclick="setDoping('intrinsic')" class="p-4 rounded-lg border-2 border-stone-200 hover:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all text-left">
                        <div class="font-bold mb-1">Intrinsic (Pure)</div>
                        <div class="text-xs text-stone-500">Pure Silicon. $n = p$. Fermi level is exactly in the middle of the gap.</div>
                    </button>
                    <button onclick="setDoping('n-type')" class="p-4 rounded-lg border-2 border-stone-200 hover:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all text-left">
                        <div class="font-bold mb-1 text-blue-700">N-Type (Donors)</div>
                        <div class="text-xs text-stone-500">Add Phosphorus (Group V). Extra electrons. Fermi level moves UP towards $E_c$.</div>
                    </button>
                    <button onclick="setDoping('p-type')" class="p-4 rounded-lg border-2 border-stone-200 hover:border-red-500 focus:ring-2 focus:ring-red-200 transition-all text-left">
                        <div class="font-bold mb-1 text-red-700">P-Type (Acceptors)</div>
                        <div class="text-xs text-stone-500">Add Boron (Group III). Extra holes. Fermi level moves DOWN towards $E_v$.</div>
                    </button>
                </div>

                <!-- Doping Visualizer -->
                <div class="bg-stone-900 p-8 rounded-xl relative h-64 w-full flex flex-col justify-center items-center transition-all duration-500" id="band-visualizer">
                    <!-- Ec -->
                    <div class="w-full border-b-2 border-stone-400 absolute top-10 flex justify-between px-4">
                        <span class="text-stone-400 text-xs">Ec (Conduction)</span>
                        <div id="electron-dots" class="flex space-x-1"></div>
                    </div>
                    
                    <!-- Fermi Level Line -->
                    <div id="fermi-line" class="w-full border-t border-dashed border-yellow-400 absolute top-1/2 transition-all duration-700 flex justify-end px-4">
                        <span class="text-yellow-400 text-xs -mt-5">Fermi Level (Ef)</span>
                    </div>

                    <!-- Intrinsic Level Line (Reference) -->
                    <div class="w-full border-t border-dotted border-stone-700 absolute top-1/2"></div>

                    <!-- Ev -->
                    <div class="w-full border-t-2 border-stone-400 absolute bottom-10 flex justify-between px-4">
                        <span class="text-stone-400 text-xs">Ev (Valence)</span>
                        <div id="hole-dots" class="flex space-x-1"></div>
                    </div>
                </div>
                <div id="doping-explanation" class="text-center text-sm font-semibold text-indigo-700 min-h-[20px]">
                    Select a type above to see the Fermi level shift.
                </div>
            </section>

            <!-- 5. Transport -->
            <section id="transport" class="space-y-6 pt-10">
                <div class="border-b border-stone-200 pb-4">
                    <h2 class="text-2xl font-bold text-stone-900">5. Transport Mechanisms</h2>
                    <p class="text-stone-500 mt-1">Drift vs. Diffusion. Einstein Relation.</p>
                </div>

                <div class="flex flex-col md:flex-row gap-8">
                    <div class="md:w-1/3 space-y-4">
                        <div class="bg-white p-4 rounded shadow-sm border border-stone-100">
                            <h4 class="font-bold text-indigo-700">1. Drift</h4>
                            <p class="text-xs text-stone-600 mt-1">Movement caused by an Electric Field ($E$).</p>
                            <code class="text-xs bg-stone-100 block p-2 mt-2 rounded">J_drift = q(n&mu;_n + p&mu;_p)E</code>
                        </div>
                        <div class="bg-white p-4 rounded shadow-sm border border-stone-100">
                            <h4 class="font-bold text-orange-600">2. Diffusion</h4>
                            <p class="text-xs text-stone-600 mt-1">Movement from high to low concentration.</p>
                            <code class="text-xs bg-stone-100 block p-2 mt-2 rounded">J_diff = qD_n(dn/dx)</code>
                        </div>
                        <div class="text-xs text-stone-500">
                            <strong>Einstein Relation:</strong> $D/\mu = kT/q$. Links thermal motion (Diffusion) to field motion (Mobility).
                        </div>
                        
                        <div class="space-y-2 pt-4 border-t border-stone-200">
                            <label class="block text-sm font-semibold">Simulation Control:</label>
                            <button onclick="toggleField(false)" class="w-full py-2 px-4 bg-stone-200 hover:bg-stone-300 rounded text-xs font-bold transition-colors">Thermal Only (Random)</button>
                            <button onclick="toggleField(true)" class="w-full py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded text-xs font-bold transition-colors">Apply Electric Field (Drift)</button>
                        </div>
                    </div>

                    <div class="md:w-2/3">
                        <div class="sim-container" id="transport-canvas-container">
                            <canvas id="transportCanvas"></canvas>
                            <div id="field-indicator" class="hidden absolute top-0 left-0 w-full h-full bg-indigo-900/10 pointer-events-none flex items-center justify-center">
                                <div class="text-4xl text-indigo-600 font-bold opacity-20">--------&gt; E-Field --------&gt;</div>
                            </div>
                        </div>
                        <p class="text-xs text-stone-500 mt-2 text-center">Particles represent electrons. Notice how they jitter randomly (temperature) but drift collectively when the field is applied.</p>
                    </div>
                </div>
            </section>

            <!-- 6. P-N Junction -->
            <section id="pn-junction" class="space-y-6 pt-10">
                <div class="border-b border-stone-200 pb-4">
                    <h2 class="text-2xl font-bold text-stone-900">6. The P-N Junction</h2>
                    <p class="text-stone-500 mt-1">The fundamental building block. Equilibrium & Bias.</p>
                </div>

                <div class="text-sm text-stone-700 space-y-2">
                    <p>When P-type and N-type materials join, diffusion creates a <strong>Depletion Region</strong> devoid of carriers. This creates a built-in electric field and potential barrier ($V_{bi}$).</p>
                </div>

                <!-- Interactive PN Diagram -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-stone-200">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold">Junction Bias Visualizer</h3>
                        <div class="flex items-center space-x-4">
                            <span class="text-xs font-bold text-red-500">Reverse Bias</span>
                            <input type="range" id="biasSlider" min="-2" max="1" step="0.1" value="0" class="slider-thumb h-2 bg-stone-300 w-32 rounded-lg appearance-none">
                            <span class="text-xs font-bold text-green-500">Forward Bias</span>
                        </div>
                    </div>
                    
                    <!-- Diagram -->
                    <div class="relative h-64 w-full bg-stone-50 border border-stone-300 rounded overflow-hidden flex" id="pn-container">
                        <!-- P-Side -->
                        <div class="h-full bg-red-50 flex-1 border-r border-stone-200 flex items-center justify-center relative">
                            <span class="absolute top-2 left-2 font-bold text-red-200 text-4xl">P</span>
                            <div class="text-xs text-red-800 text-center">Holes (Major)<br>Acceptors (-)</div>
                        </div>
                        
                        <!-- Depletion Region -->
                        <div id="depletion-region" class="h-full bg-stone-200 absolute left-1/2 transform -translate-x-1/2 border-l border-r border-stone-300 transition-all duration-300 flex items-center justify-center overflow-hidden" style="width: 100px;">
                            <div class="text-[10px] text-stone-500 text-center leading-tight">Space<br>Charge<br>Region</div>
                            <!-- Built-in Field Arrow -->
                            <div class="absolute bottom-4 w-3/4 h-0.5 bg-stone-400"></div>
                            <div class="absolute bottom-4 left-2 text-[8px]">E-field</div>
                        </div>

                        <!-- N-Side -->
                        <div class="h-full bg-blue-50 flex-1 border-l border-stone-200 flex items-center justify-center relative">
                            <span class="absolute top-2 right-2 font-bold text-blue-200 text-4xl">N</span>
                            <div class="text-xs text-blue-800 text-center">Electrons (Major)<br>Donors (+)</div>
                        </div>
                    </div>

                    <!-- Metrics -->
                    <div class="grid grid-cols-3 gap-4 mt-6 text-center">
                        <div class="p-2 bg-stone-50 rounded">
                            <div class="text-xs text-stone-500">Bias Voltage ($V_a$)</div>
                            <div id="val-bias" class="font-mono font-bold">0.0 V</div>
                        </div>
                        <div class="p-2 bg-stone-50 rounded">
                            <div class="text-xs text-stone-500">Barrier Height ($V_{bi} - V_a$)</div>
                            <div id="val-barrier" class="font-mono font-bold">0.7 V</div>
                        </div>
                        <div class="p-2 bg-stone-50 rounded">
                            <div class="text-xs text-stone-500">Current ($I$)</div>
                            <div id="val-current" class="font-mono font-bold text-indigo-600">~0 mA</div>
                        </div>
                    </div>
                </div>

                <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100 text-sm">
                    <strong>Physics of Biasing:</strong>
                    <ul class="list-disc ml-5 mt-2 space-y-1">
                        <li><strong>Forward Bias ($V > 0$):</strong> Lowers the barrier. Diffusion current explodes exponentially (Shockley Eq: $I = I_s(e^{qV/kT} - 1)$).</li>
                        <li><strong>Reverse Bias ($V < 0$):</strong> Increases the barrier. Widens depletion region. Only tiny leakage current flows.</li>
                    </ul>
                </div>
            </section>

             <!-- 7. Circuit & Fab -->
             <section id="circuit" class="space-y-6 pt-10">
                <div class="border-b border-stone-200 pb-4">
                    <h2 class="text-2xl font-bold text-stone-900">7. Circuit & Fabrication Basics</h2>
                    <p class="text-stone-500 mt-1">Connecting Physics to Engineering.</p>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <h3 class="font-bold text-lg border-b pb-2">Circuit Analysis Tools</h3>
                        <div class="group cursor-pointer">
                            <div class="font-semibold text-indigo-700">KVL & KCL</div>
                            <p class="text-sm text-stone-600">Kirchhoff's laws govern energy and charge conservation in loops and nodes. Essential for analyzing transistor bias circuits.</p>
                        </div>
                        <div class="group cursor-pointer">
                            <div class="font-semibold text-indigo-700">Thevenin's Theorem</div>
                            <p class="text-sm text-stone-600">Simplifies complex bias networks into a single voltage source and resistor ($V_{th}, R_{th}$), making it easier to find the "Q-point" of a diode or transistor.</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="font-bold text-lg border-b pb-2">Fabrication (The "How")</h3>
                        <ul class="text-sm space-y-2 text-stone-600">
                            <li><strong>1. Oxidation:</strong> Growing SiO2 insulator on Si wafer.</li>
                            <li><strong>2. Photolithography:</strong> Using light to transfer patterns from a mask to photoresist.</li>
                            <li><strong>3. Etching:</strong> Removing material to create windows.</li>
                            <li><strong>4. Ion Implantation:</strong> Shooting Dopant ions (Boron/Phosphorus) into the silicon to create P and N regions.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="pt-20 pb-10 text-center text-stone-400 text-xs">
                <p>Designed for Physics Students. Concepts simplified for interactive learning.</p>
                <p>&copy; The Quantum Lab</p>
            </footer>

        </main>
    </div>

    <!-- JavaScript Implementation -->
    <script>
        // --- 1. Fermi-Dirac Chart Logic ---
        const ctxFermi = document.getElementById('fermiChart').getContext('2d');
        const Ef = 0; // Reference Energy
        
        function fermiDirac(E, T) {
            const k = 8.617e-5; // Boltzmann constant in eV/K
            if (T === 0) {
                return E < Ef ? 1 : 0;
            }
            return 1 / (1 + Math.exp((E - Ef) / (k * T)));
        }

        // Generate data based on T
        function generateFermiData(T) {
            const data = [];
            for (let E = -0.5; E <= 0.5; E += 0.01) {
                data.push({x: fermiDirac(E, T), y: E});
            }
            return data;
        }

        const fermiChart = new Chart(ctxFermi, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Probability f(E)',
                    data: generateFermiData(300),
                    borderColor: '#4f46e5',
                    backgroundColor: '#4f46e5',
                    showLine: true,
                    pointRadius: 0,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: { display: true, text: 'Probability f(E)' },
                        min: 0, max: 1.1
                    },
                    y: {
                        title: { display: true, text: 'Energy (eV)' },
                        min: -0.5, max: 0.5,
                        grid: {
                            color: (context) => context.tick.value === 0 ? '#fbbf24' : '#e5e7eb', // Highlight Ef
                            lineWidth: (context) => context.tick.value === 0 ? 2 : 1
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        enabled: true,
                        callbacks: {
                            label: (ctx) => `E: ${ctx.raw.y.toFixed(2)}eV, P: ${(ctx.raw.x * 100).toFixed(1)}%`
                        }
                    },
                    annotation: {
                        // Chart.js annotation plugin not loaded, using grid line hack for Ef
                    }
                }
            }
        });

        // Fermi Slider Interaction
        const tempSlider = document.getElementById('tempSlider');
        const tempValue = document.getElementById('tempValue');

        tempSlider.addEventListener('input', (e) => {
            const T = parseInt(e.target.value);
            tempValue.textContent = `${T}K`;
            fermiChart.data.datasets[0].data = generateFermiData(T);
            fermiChart.update();
        });


        // --- 2. Doping Visualizer Logic ---
        const fermiLine = document.getElementById('fermi-line');
        const electronDots = document.getElementById('electron-dots');
        const holeDots = document.getElementById('hole-dots');
        const explanation = document.getElementById('doping-explanation');

        function setDoping(type) {
            // Reset
            electronDots.innerHTML = '';
            holeDots.innerHTML = '';
            
            if (type === 'intrinsic') {
                fermiLine.style.top = '50%';
                explanation.innerText = "Intrinsic: Fermi level is centered. Carrier concentration is low.";
                addDot(electronDots, 'bg-blue-400', 1);
                addDot(holeDots, 'border-red-500 border-2', 1);
            } else if (type === 'n-type') {
                fermiLine.style.top = '25%'; // Closer to Ec
                explanation.innerText = "N-Type: Donors add electrons. Ef moves up near Conduction Band.";
                addDot(electronDots, 'bg-blue-400', 5);
                addDot(holeDots, 'border-red-500 border-2', 1);
            } else if (type === 'p-type') {
                fermiLine.style.top = '75%'; // Closer to Ev
                explanation.innerText = "P-Type: Acceptors add holes. Ef moves down near Valence Band.";
                addDot(electronDots, 'bg-blue-400', 1);
                addDot(holeDots, 'border-red-500 border-2', 5);
            }
        }

        function addDot(container, classes, count) {
            for(let i=0; i<count; i++) {
                const dot = document.createElement('div');
                dot.className = `w-3 h-3 rounded-full ${classes}`;
                container.appendChild(dot);
            }
        }


        // --- 3. Transport Simulation (Canvas) ---
        const canvas = document.getElementById('transportCanvas');
        const ctx = canvas.getContext('2d');
        let animationId;
        let particles = [];
        let fieldOn = false;

        // Resize canvas
        function resizeCanvas() {
            const container = document.getElementById('transport-canvas-container');
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 2; // Thermal velocity
                this.vy = (Math.random() - 0.5) * 2;
                this.size = 3;
            }

            update() {
                // Random thermal jitter
                this.x += (Math.random() - 0.5) * 4; 
                this.y += (Math.random() - 0.5) * 4;

                // Drift Component
                if (fieldOn) {
                    this.x += 2; // Drift velocity to right
                }

                // Boundary wrap
                if (this.x > canvas.width) this.x = 0;
                if (this.x < 0) this.x = canvas.width;
                if (this.y > canvas.height) this.y = 0;
                if (this.y < 0) this.y = canvas.height;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = '#4f46e5';
                ctx.fill();
            }
        }

        // Initialize particles
        for(let i=0; i<80; i++) {
            particles.push(new Particle());
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            animationId = requestAnimationFrame(animate);
        }
        animate();

        function toggleField(state) {
            fieldOn = state;
            const indicator = document.getElementById('field-indicator');
            if(state) indicator.classList.remove('hidden');
            else indicator.classList.add('hidden');
        }


        // --- 4. PN Junction Bias Logic ---
        const biasSlider = document.getElementById('biasSlider');
        const depletionRegion = document.getElementById('depletion-region');
        const valBias = document.getElementById('val-bias');
        const valBarrier = document.getElementById('val-barrier');
        const valCurrent = document.getElementById('val-current');

        biasSlider.addEventListener('input', (e) => {
            const V = parseFloat(e.target.value);
            const builtInV = 0.7;
            const netBarrier = Math.max(0, builtInV - V);
            
            // Visual Width Calculation (Reverse bias widens, Forward shrinks)
            // W is proportional to sqrt(Vbi - V) roughly, but simplified for visual
            let width = 100;
            if (V < 0) width = 100 + (Math.abs(V) * 50);
            else width = Math.max(10, 100 - (V * 90));

            depletionRegion.style.width = `${width}px`;

            // Update Text
            valBias.textContent = `${V > 0 ? '+' : ''}${V.toFixed(2)} V`;
            valBias.className = `font-mono font-bold ${V > 0 ? 'text-green-600' : (V < 0 ? 'text-red-600' : '')}`;
            
            valBarrier.textContent = `${netBarrier.toFixed(2)} V`;

            // Calculate "Toy" Current
            let I = 0;
            if (V > 0.5) {
                I = Math.exp((V - 0.5) * 5); // Rapid rise
            } else if (V < 0) {
                I = -0.01; // Leakage
            }
            
            let iText = "0 mA";
            if (I > 100) iText = "> 100 mA";
            else if (I > 0.1) iText = I.toFixed(1) + " mA";
            else if (I < 0) iText = "~ pA (Leakage)";
            
            valCurrent.textContent = iText;
        });

        // --- Navigation Logic ---
        function scrollToSection(id) {
            const el = document.getElementById(id);
            if(el) el.scrollIntoView({behavior: 'smooth'});
            
            // Update active state
            document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
            const navBtn = document.getElementById('nav-' + id);
            if(navBtn) navBtn.classList.add('active');
        }

        // Initialize first section active
        document.getElementById('nav-intro')?.classList.add('active');

        // Initial set doping
        setDoping('intrinsic');

    </script>
</body>
</html>
